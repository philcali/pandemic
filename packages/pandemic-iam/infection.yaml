metadata:
  name: pandemic-iam
  version: 1.0.0
  description: IMDSv2-style metadata service for cloud credentials
  author: Pandemic Team

source:
  type: github
  url: github://pandemic-org/pandemic-iam@v1.0.0

systemd:
  user: pandemic-iam
  group: pandemic
  working_directory: /opt/pandemic/infections/pandemic-iam
  environment:
    PYTHONPATH: "/opt/pandemic/infections/pandemic-iam/src"
    PANDEMIC_IAM_CONFIG: "/etc/pandemic/iam/config.yaml"

execution:
  command: ./bin/pandemic-iam
  restart: always
  restart_sec: 10

resources:
  memory_limit: 256M
  cpu_quota: 25%

security:
  capabilities: 
    - CAP_NET_BIND_SERVICE  # Required to bind to port 80
  read_only_root: false
  no_new_privileges: true

# IMDSv2-style Metadata Server Configuration
metadata_server:
  host: 169.254.169.254  # AWS IMDS address
  port: 80               # Standard HTTP port

providers:
  aws:
    enabled: false
    region: us-east-1
    rolesanywhere_endpoint: https://rolesanywhere.us-east-1.amazonaws.com
    trust_anchor_arn: ""
    profile_arn: ""
    role_arn: ""
    
  azure:
    enabled: false
    tenant_id: ""
    certificate_auth_endpoint: https://login.microsoftonline.com
    
  gcp:
    enabled: false
    project_id: ""
    certificate_auth_endpoint: https://oauth2.googleapis.com

certificates:
  base_path: /etc/pandemic/certs
  ca_bundle: /etc/pandemic/certs/ca-bundle.pem
  default_cert: /etc/pandemic/certs/pandemic-iam.pem
  default_key: /etc/pandemic/certs/pandemic-iam.key
  file_permissions: 0600
  renewal_days: 30

security:
  max_session_duration: 43200
  credential_cache_ttl: 300
  token_cleanup_interval: 300
  audit_all_operations: true

logging:
  level: INFO
  structured: true
  audit_file: /var/log/pandemic/iam-audit.log